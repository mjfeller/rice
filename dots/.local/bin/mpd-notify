#!/bin/sh

tmp="/tmp/cover.jpg"
form="Artist: %artist%\nAlbum: %album%\nTitle:%title%"

while true; do
	# wait until MPD does something
	mpc idle player > /dev/null
	rm -f $tmp
	
	# create the notification text
	toprint="`mpc status -f \"$form\" | head -n3 | sed \"s:&:&amp;:g\"`"
	artpath="/home/mjf/Music/$(dirname "$(mpc status -f '%file%' | head -n1)")/cover.jpg"

	# generate the cover icon if we find one
	if [ -f "$artpath" ]; then
		convert -resize 128x128 "$artpath" $tmp
	fi
	
	# send out the notication with the cover icon and song information
	notify-send -i "$tmp" "$toprint"
done
